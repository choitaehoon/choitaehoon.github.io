---
title: 인스타그램과 같은 SNS 플랫폼은 어떻게 많은 트래픽을 처리할 까? - 1편
date: 2020-10-03 14:15:00 
---

### 배경
인스타그램과 같은 SNS 플랫폼은 사용자로부터 인기를 받으면서 급격한 성장세로 이용률이 증가하고 있습니다.
개발자의 관점에서 이 말을 해석하자면 애플리케이션에 대한 요청 수가 급격히 증가했다고 볼 수 있습니다.
애플리케이션에 대한 요청을 처리하기 위해 Thread Pool 안에 있는 Thread를 꺼내 요청, 응답처리 한 뒤 Thread Pool에 Thread를 반납합니다.
요청이 증가할수록 Thread Pool 안에 있는 Thread를 꺼내 사용하는 횟수가 증가하게 되고 결국 Thread를 반납하는 횟수보다 요청하는 횟수가 더 많아
Thread Pool 안에 있는 Thread 자원이 없어 애플리케이션에 들어오는 요청은 지연될 수 밖에 없는 상황이 올 수 있습니다.

그렇다면 Thread 개수를 증가시켜 문제를 해결하면 되지 않을까? 라는 생각을 하지만 결론부터 말하자면 Thread Context switch overhead 문제로
완전한 해결방법이 아닙니다.

애플리케이션의 급격한 요청 수를 해결하고자 Scale-up과 Scale-out을 생각했고 정의, 장단점을 찾아보고 현재 진행하고 있는 프로젝트에 어떤 걸 적용할지
파악해보겠습니다.

### Scale-up과 Scale-out 정의

![image](https://user-images.githubusercontent.com/33123391/94989760-0ae48c80-05b2-11eb-889d-ac8d1f1b4eef.png)

Scale-up은 서버에 CPU, RAM을 추가하거나 고성능의 부품 서버로 교환하는 방법을 의미합니다.
서버 한 대에 모든 부하가 집중되므로 장애가 발생하게 되면 크게 영향을 받을 수 있는 위험성이 존재합니다. 

Scale-out은 서버 여러 대를 추가하여 시스템을 확장하는 방법입니다.
서버 여러 대가 추가되기 때문에 각 서버에 걸리는 부하를 균등하게 해주는 `로드밸런싱` 이 필수적으로 동반되어야 합니다.


### 장단점 비교
![image](https://user-images.githubusercontent.com/33123391/94989793-51d28200-05b2-11eb-9901-bb80a4e153cc.png)


### Scale-out 적용

진행하고 있는 프로젝트에 Scale-out을 선택했습니다. 이유는 아래와 같습니다.
1. 서버를 증설하여 트래픽을 부하 분산시킴으로써 서버 한 곳에 장애가 발생하더라도 다른 서버에서 서비스를 제공할 수 있습니다.
만일 서버 한 대를 기반으로 애플리케이션의 요청을 수행하다가 장애가 발생하게 되면 사용자의 요청을 처리할 수 없는 치명적인 상황이 발생할 수 있습니다.
이러한 문제점을 해결하고자 다른 서버를 통해 연속적인 서비스를 지원 가능하게 해야 합니다.

2. 수평 확장에 용이한 구조로 되어 있습니다. 트래픽의 부하 분산을 위해 여러 대의 서버를 구축했다 하더라도 많은 트래픽이 발생하게 되면
장애가 생길 가능성은 여전히 남아 있습니다. 이때 서버 증설 확장에 대한 검토를 진행하고 문제가 없다고 판단되면 확장하면 됩니다.

3. Scale-up보다 가격이 저렴합니다. 서버 성능이 향상함에 따라 비용 증가 폭이 큽니다. 하지만 Scale-out은 비교적 저렴한 서버를 사용하여
증설할 수 있습니다.

### Scale-out의 문제점
Scale-out을 적용한 이유만 보면 무조건 Scale-out만 사용해야 한다고 느낄 수 있습니다. 하지만 Scale-out에서도 문제점이 발생할 수 있는데 이유는 아래와 같습니다.
1. 설계, 구현에 대한 복잡성이 증가하는 문제로 아키텍처(로드 밸런싱)에 대한 높은 이해가 필요합니다.

2. 여러 대의 서버가 늘어남에 따라 각 서버에 설치해야 하는 소프트웨어 라이센스 비용이 증가합니다.

3. 각각의 서버 세션을 이용하여 데이터 정합성 이슈가 발생하게 됩니다.

### 마치며
Scale-out과 Scale-up에 대해 알아보는 시간을 가졌습니다. 프로젝트에서 Scale-out을 선정했고 Scale-out을 적용할 때의 문제점은
아키텍처의 높은 이해도, 각 서버에 설치해야 하는 소프트웨어 라이센스 비용, 데이터 정합성 이슈가 발생할 수 있다고 했습니다.
첫 번째 문제는 아키텍처에 대한 학습을 통해 해결할 수 있고, 두 번째 문제는 소프트웨어 라이센스 비용은 가능하다면 오픈소스를 활용해 어느 정도의 비용을
줄일 수 있습니다. 하지만 세 번째 문제인 **데이터 정합성 이슈는 어떻게 해결할 수 있을까?** 라는 고민이 생깁니다.
다음 편에서 데이터 정합성 이슈에 대해 살펴보고 해결 방안을 제시하는 시간을 갖겠습니다.

참조 블로그
* http://library.gabia.com/contents/infrahosting/1222
* https://butter-shower.tistory.com/109